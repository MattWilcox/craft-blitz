{% import "_includes/forms" as forms %}


{{ forms.autosuggestField({
    label: "Email"|t('blitz'),
    instructions: "The email address associated with your Cloudflare account."|t('blitz'),
    suggestEnvVars: true,
    suggestions: craft.cp.getEnvSuggestions(),
    name: 'email',
    value: purger.email,
    errors: purger.getErrors('email'),
    required: true,
}) }}

{{ forms.autosuggestField({
    label: "Global API Key"|t('blitz'),
    instructions: "The global API key for your Cloudflare account. This can be found under “My Profile” in your Cloudflare account."|t('blitz'),
    suggestEnvVars: true,
    suggestions: craft.cp.getEnvSuggestions(),
    name: 'apiKey',
    value: purger.apiKey,
    errors: purger.getErrors('apiKey'),
    required: true,
}) }}

{% set rows = [] %}
{% for site in craft.app.sites.getAllSites() %}
    {% set rows = rows|merge({
        (site.handle): {
            heading: site.name|t('site')|e,
            zoneId: {
                value: purger.zoneIds[site.handle] is defined ? purger.zoneIds[site.handle]['zoneId'],
            },
        }
    }) %}
{% endfor %}

{% set cols = {
    heading: {
        type: 'heading',
        heading: "Site"|t('blitz'),
        thin: true,
    },
    zoneId: {
        type: 'singleline',
        heading: "Zone ID"|t('blitz'),
    },
} %}

{{ forms.editableTableField({
    label: "Zone IDs"|t('blitz'),
    instructions: "The zone IDs for your sites. These can be found on the “Overview” screen of your domains in your Cloudflare account."|t('blitz'),
    name: 'zoneIds',
    id: 'zoneIds',
    cols: cols,
    rows: rows,
    staticRows: true,
    errors: purger.getErrors('zoneIds'),
}) }}

{% set helpText %}
Cloudflare does not cache HTML by default. To enable static page caching, create a new page rule in the “Page Rules” page of the domain in your account (you get 3 page rules with a free plan). Enter a URL pattern such as `domain.com/*` and add a “Cache Level” setting with a value of “Cache Everything”. Click “Save and Deploy” and then visit your site. With dev tools open you should see a cache response (`HIT`, `MISS`, etc.) in the `CF-Cache-Status` header.
{% endset %}

<div class="light">
    {{ helpText|markdown }}
</div>
