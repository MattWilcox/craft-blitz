{% import "_includes/forms" as forms %}


{% set cols = {
    heading: {
        type: 'heading',
        heading: "Site"|t('blitz'),
        thin: true,
    },
    repositoryPath: {
        type: 'singleline',
        heading: "Repository Path"|t('blitz'),
        info: "The folder path to an existing local repository. This can be set to an environment variable, or begin with an alias such as `@root`."|t('blitz'),
        placeholder: "@root/path/to/repo",
    },
    commitMessage: {
        type: 'singleline',
        heading: "Commit Message"|t('blitz'),
        placeholder: deployer.defaultCommitMessage,
    },
    branch: {
        type: 'singleline',
        heading: "Branch"|t('blitz'),
        placeholder: deployer.defaultBranch,
    },
} %}

{% set rows = [] %}
{% for site in craft.app.sites.getAllSites() %}
    {% set rows = rows|merge({
        (site.uid): {
            heading: site.name,
            repositoryPath: deployer.gitSettings[site.uid] is defined ? deployer.gitSettings[site.uid]['repositoryPath'],
            commitMessage: deployer.gitSettings[site.uid] is defined ? deployer.gitSettings[site.uid]['commitMessage'],
            branch: deployer.gitSettings[site.uid] is defined ? deployer.gitSettings[site.uid]['branch'],
        }
    }) %}
{% endfor %}

{% set info %}
    <span class="info">{{ 'Warmed pages will be commited and pushed to existing Git repositories using the specified settings. Git must already be installed on the server and the repositories must already exist with the appropriate credentials. <a href="{url}" class="go" target="_blank">Learn more</a>'|t('blitz', {url: 'git-deployer'})|raw }}</span>
{% endset %}
{{ forms.editableTableField({
    label: "Git Settings"|t('blitz'),
    instructions: "Choose which repositories to commit and push to for each sites."|t('blitz') ~ info,
    name: 'gitSettings',
    id: 'gitSettings',
    cols: cols,
    rows: rows,
    staticRows: true,
    errors: deployer.getErrors('gitSettings'),
}) }}
